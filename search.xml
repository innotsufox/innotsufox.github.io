<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Docx4j 富文本Java解决方案 Docx-&gt;Html-&gt;Docx-&gt;Pdf</title>
    <url>/docx4j.html</url>
    <content><![CDATA[<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h2><p>Java 操作Office的库：</p>
<ol>
<li><code>POI</code>功能强大且复杂</li>
<li><code>Docx4j</code> 主要针对<code>docx</code>文件</li>
</ol>
<a id="more"></a>

<p>痛点:</p>
<ol>
<li>格式转换过程中的样式问题。</li>
<li>字体支持问题；</li>
<li>图片以及其他多媒体处理方式。</li>
</ol>
<p>针对问题一：</p>
<ul>
<li><code>XHTMLImporter.convert()</code> 方法将<code>html</code>转为<code>docx</code>，出现<strong>表格</strong>超出屏幕，<strong>中文字体</strong>不生效变成默认<strong>等线字体</strong>，<strong>图片变大</strong>，问题较多，只能暂时放弃此方法。</li>
<li>后发现<code>docx4j</code>的<code>altChunk</code>方式，将<code>html</code>文本转<code>docx</code>，能较好地还原文档，但出现<strong>字体变大一号问题</strong>，暂未解决。</li>
</ul>
<p>针对问题二：</p>
<ul>
<li><code>docx</code>转<code>pdf</code>时，可能出现。<code>Linux</code>环境，需要下载字体文件引入，配置字体映射。</li>
</ul>
<p>针对问题三：</p>
<ul>
<li>本文只介绍图片的处理方式。<code>docx-&gt;html</code>，通过接口默认方法，获取路径下图片资源转为<code>base64</code>，替换<code>img</code>标签中<code>src</code>属性。</li>
</ul>
<h2 id="2-代码"><a href="#2-代码" class="headerlink" title="2. 代码"></a>2. 代码</h2><h3 id="2-1-依赖"><a href="#2-1-依赖" class="headerlink" title="2.1 依赖"></a>2.1 依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 转pdf不要再引入docx4j --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">docx4j-ImportXHTML.version</span>&gt;</span>8.2.1<span class="tag">&lt;/<span class="name">docx4j-ImportXHTML.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">docx4j-JAXB-Internal.version</span>&gt;</span>8.3.4<span class="tag">&lt;/<span class="name">docx4j-JAXB-Internal.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">docx4j-JAXB-ReferenceImpl.version</span>&gt;</span>8.3.4<span class="tag">&lt;/<span class="name">docx4j-JAXB-ReferenceImpl.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">docx4j-JAXB-MOXy.version</span>&gt;</span>8.3.4<span class="tag">&lt;/<span class="name">docx4j-JAXB-MOXy.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">docx4j-export-fo.version</span>&gt;</span>8.3.4<span class="tag">&lt;/<span class="name">docx4j-export-fo.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jsoup.version</span>&gt;</span>1.14.3<span class="tag">&lt;/<span class="name">jsoup.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.docx4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>docx4j-ImportXHTML<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;docx4j-ImportXHTML.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.docx4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>docx4j-JAXB-Internal<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;docx4j-JAXB-Internal.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.docx4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>docx4j-JAXB-ReferenceImpl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;docx4j-JAXB-ReferenceImpl.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.docx4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>docx4j-JAXB-MOXy<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;docx4j-JAXB-MOXy.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.docx4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>docx4j-export-fo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;docx4j-export-fo.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jsoup<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsoup<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jsoup.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-Docx转html"><a href="#2-2-Docx转html" class="headerlink" title="2.2 Docx转html"></a>2.2 Docx转html</h3><p><code>Docx4jUtils.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Docx 2 html.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> docxPath     the docx path</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> htmlPath     the html path</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> srcPath      docx中图片资源存放路径</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> srcNetPath   网络路径</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> imageHandler the image handler</span></span><br><span class="line"><span class="comment">* <span class="doctag">@throws</span> Exception the exception</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">docx2html</span><span class="params">(String docxPath, String htmlPath, String srcPath, String srcNetPath,</span></span></span><br><span class="line"><span class="function"><span class="params">                             IHtmlImageHandler imageHandler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    File file = <span class="keyword">new</span> File(docxPath);</span><br><span class="line">    <span class="comment">// docx名称</span></span><br><span class="line">    String fileName = file.getName().substring(<span class="number">0</span>, file.getName().lastIndexOf(<span class="string">"."</span>));</span><br><span class="line">    <span class="comment">// 图片资源本地路径</span></span><br><span class="line">    String srcUri = srcPath + File.separator + fileName;</span><br><span class="line">    <span class="comment">// 图片资源网络路径</span></span><br><span class="line">    String srcNet = srcNetPath + File.separator + fileName;</span><br><span class="line">    <span class="comment">// 创建docx package</span></span><br><span class="line">    WordprocessingMLPackage wordMLPackage = WordprocessingMLPackage.load(file);</span><br><span class="line">    HTMLSettings htmlSettings = Docx4J.createHTMLSettings();</span><br><span class="line">    htmlSettings.setOpcPackage(wordMLPackage);</span><br><span class="line">    <span class="comment">// 图片资源保存路径</span></span><br><span class="line">    htmlSettings.setImageDirPath(srcUri);</span><br><span class="line">    <span class="comment">// image标签src路径</span></span><br><span class="line">    htmlSettings.setImageTargetUri(srcNet);</span><br><span class="line"></span><br><span class="line">    FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(htmlPath);</span><br><span class="line">    <span class="comment">// 写入html</span></span><br><span class="line">    Docx4J.toHTML(htmlSettings, fos, Docx4J.FLAG_NONE);</span><br><span class="line">    fos.close();</span><br><span class="line">    <span class="comment">// 处理img</span></span><br><span class="line">    String html = imageHandler.htmlImage2base64(htmlPath);</span><br><span class="line">    <span class="comment">// 写出</span></span><br><span class="line">    Files.write(Paths.get(htmlPath), html.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>图片处理接口：<code>IHtmlImageHandler.java</code>，提供默认<code>base64</code>处理方式，重写其方法使用其他方式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.jsoup.Jsoup;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.nodes.Document;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.nodes.Element;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.select.Elements;</span><br><span class="line"><span class="keyword">import</span> sun.misc.BASE64Encoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The interface Html image handler.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> innofox</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022 /3/15 21:18</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> docx to html 图片处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IHtmlImageHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Html image 2 base 64 string.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> htmlPath the html path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the string</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception the exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> String <span class="title">htmlImage2base64</span><span class="params">(String htmlPath)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        List&lt;String&gt; strings = Files.readAllLines(Paths.get(htmlPath));</span><br><span class="line">        StringBuilder html = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (String string : strings) &#123;</span><br><span class="line">            html.append(string);</span><br><span class="line">        &#125;</span><br><span class="line">        Document document = Jsoup.parse(html.toString());</span><br><span class="line">        Elements imgElements = document.getElementsByTag(TagsInstant.IMG_TAG);</span><br><span class="line">        <span class="keyword">for</span> (Element imgElement : imgElements) &#123;</span><br><span class="line">            <span class="comment">// 图片路径</span></span><br><span class="line">            String attr = imgElement.attr(TagsInstant.SRC);</span><br><span class="line">            String base64 = IHtmlImageHandler.image2Base64(attr);</span><br><span class="line">            imgElement.attr(TagsInstant.SRC, <span class="string">"data:image/"</span> +</span><br><span class="line">                    attr.substring(attr.lastIndexOf(<span class="string">"."</span>) + <span class="number">1</span>).toLowerCase(Locale.ROOT) +</span><br><span class="line">                    <span class="string">";base64,"</span> +</span><br><span class="line">                    base64);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> document.html();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Image 2 base 64 string.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> imgPath the img path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the string</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception the exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> String <span class="title">image2Base64</span><span class="params">(String imgPath)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = Files.readAllBytes(Paths.get(imgPath));</span><br><span class="line">        BASE64Encoder encoder = <span class="keyword">new</span> BASE64Encoder();</span><br><span class="line">        <span class="keyword">return</span> encoder.encode(bytes);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现<code>IHtmlImageHandler</code>接口：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HtmlImageHandler</span> <span class="keyword">implements</span> <span class="title">IHtmlImageHandler</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>标签常量类：<code>TagsInstant</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TagsInstant</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG_1 = <span class="string">"/&gt;"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG_META = <span class="string">"&lt;/meta&gt;"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG_BR = <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String META = <span class="string">"meta"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String BR = <span class="string">"br"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String IMG_TAG = <span class="string">"img"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SRC = <span class="string">"src"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-html转docx"><a href="#2-3-html转docx" class="headerlink" title="2.3 html转docx"></a>2.3 html转docx</h3><p><code>Docx4jUtils.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Html as alt chunk 2 docx.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> htmlPath the html path</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> docxPath the docx path</span></span><br><span class="line"><span class="comment">* <span class="doctag">@throws</span> Exception the exception</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">htmlAsAltChunk2Docx</span><span class="params">(String htmlPath, String docxPath)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    List&lt;String&gt; strings = Files.readAllLines(Paths.get(htmlPath));</span><br><span class="line">    StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">for</span> (String string : strings) &#123;</span><br><span class="line">      sb.append(string)</span><br><span class="line">        .append(<span class="string">"\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    WordprocessingMLPackage wordMLPackage = WordprocessingMLPackage.createPackage();</span><br><span class="line">    MainDocumentPart mdp = wordMLPackage.getMainDocumentPart();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Add the Html altChunk</span></span><br><span class="line">    String xhtml = sb.toString();</span><br><span class="line">    mdp.addAltChunk(AltChunkType.Html, xhtml.getBytes());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Round trip</span></span><br><span class="line">    WordprocessingMLPackage pkgOut = mdp.convertAltChunks();</span><br><span class="line"></span><br><span class="line">    pkgOut.save(<span class="keyword">new</span> File(docxPath));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-docx转pdf"><a href="#2-4-docx转pdf" class="headerlink" title="2.4 docx转pdf"></a>2.4 docx转pdf</h3><p><code>Docx4jUtils.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> IFontHandler fontHandler;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Instantiates a new Docx 4 j utils.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> fontHandler the font handler</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Docx4jUtils</span><span class="params">(IFontHandler fontHandler)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.fontHandler = fontHandler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Docx4jUtils.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Docx 2 pdf.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> docxPath the docx path</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> pdfPath  the pdf path</span></span><br><span class="line"><span class="comment">* <span class="doctag">@throws</span> Exception the exception</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">docx2Pdf</span><span class="params">(String docxPath, String pdfPath)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    FileInputStream fis = <span class="keyword">new</span> FileInputStream(docxPath);</span><br><span class="line">    WordprocessingMLPackage wordPackage = WordprocessingMLPackage.load(fis);</span><br><span class="line">    <span class="comment">// 字体</span></span><br><span class="line">    fontHandler.setFontMapper(wordPackage);</span><br><span class="line">    FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(pdfPath);</span><br><span class="line">    Docx4J.toPDF(wordPackage, fos);</span><br><span class="line">    fos.flush();</span><br><span class="line">    fos.close();</span><br><span class="line">    fis.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字体处理接口：<code>IFontHandler.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.docx4j.fonts.IdentityPlusMapper;</span><br><span class="line"><span class="keyword">import</span> org.docx4j.fonts.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.docx4j.fonts.PhysicalFonts;</span><br><span class="line"><span class="keyword">import</span> org.docx4j.openpackaging.packages.WordprocessingMLPackage;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The interface Font handler.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> innofox</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022 /3/20 11:34</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IFontHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Sets font mapper.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> wordMLPackage the word ml package</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception the exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">void</span> <span class="title">setFontMapper</span><span class="params">(WordprocessingMLPackage wordMLPackage)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        wordMLPackage.setFontMapper(getFontMapper());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Gets font mapper.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the font mapper</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> Mapper <span class="title">getFontMapper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Mapper fontMapper = <span class="keyword">new</span> IdentityPlusMapper();</span><br><span class="line">        fontMapper.put(<span class="string">"隶书"</span>, PhysicalFonts.get(<span class="string">"LiSu"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"宋体"</span>, PhysicalFonts.get(<span class="string">"SimSun"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"微软雅黑"</span>, PhysicalFonts.get(<span class="string">"Microsoft Yahei"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"黑体"</span>, PhysicalFonts.get(<span class="string">"SimHei"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"楷体"</span>, PhysicalFonts.get(<span class="string">"KaiTi"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"新宋体"</span>, PhysicalFonts.get(<span class="string">"NSimSun"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"华文行楷"</span>, PhysicalFonts.get(<span class="string">"STXingkai"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"华文仿宋"</span>, PhysicalFonts.get(<span class="string">"STFangsong"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"仿宋"</span>, PhysicalFonts.get(<span class="string">"FangSong"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"幼圆"</span>, PhysicalFonts.get(<span class="string">"YouYuan"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"华文宋体"</span>, PhysicalFonts.get(<span class="string">"STSong"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"华文中宋"</span>, PhysicalFonts.get(<span class="string">"STZhongsong"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"等线"</span>, PhysicalFonts.get(<span class="string">"SimSun"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"等线 Light"</span>, PhysicalFonts.get(<span class="string">"SimSun"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"华文琥珀"</span>, PhysicalFonts.get(<span class="string">"STHupo"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"华文隶书"</span>, PhysicalFonts.get(<span class="string">"STLiti"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"华文新魏"</span>, PhysicalFonts.get(<span class="string">"STXinwei"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"华文彩云"</span>, PhysicalFonts.get(<span class="string">"STCaiyun"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"方正姚体"</span>, PhysicalFonts.get(<span class="string">"FZYaoti"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"方正舒体"</span>, PhysicalFonts.get(<span class="string">"FZShuTi"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"华文细黑"</span>, PhysicalFonts.get(<span class="string">"STXihei"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"宋体扩展"</span>, PhysicalFonts.get(<span class="string">"simsun-extB"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"仿宋_GB2312"</span>, PhysicalFonts.get(<span class="string">"FangSong_GB2312"</span>));</span><br><span class="line">        fontMapper.put(<span class="string">"新細明體"</span>, PhysicalFonts.get(<span class="string">"SimSun"</span>));</span><br><span class="line">        <span class="keyword">return</span> fontMapper;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>FontHandler.java</code>实现<code>IFontHandler</code></p>
<p>默认使用<code>simsun</code>字体</p>
<p>文件: <code>simsun.ttc</code></p>
<p>Windows下可不用自己添加字体文件，见最后测试方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.docx4j.fonts.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.docx4j.fonts.PhysicalFont;</span><br><span class="line"><span class="keyword">import</span> org.docx4j.fonts.PhysicalFonts;</span><br><span class="line"><span class="keyword">import</span> org.docx4j.openpackaging.packages.WordprocessingMLPackage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> innofox</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/3/20 11:38</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FontHandler</span> <span class="keyword">implements</span> <span class="title">IFontHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String simSunPath;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FontHandler</span><span class="params">(String simSunPath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.simSunPath = simSunPath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFontMapper</span><span class="params">(WordprocessingMLPackage wordMLPackage)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 设置宋体</span></span><br><span class="line">        PhysicalFonts.addPhysicalFonts(<span class="string">"SimSun"</span>, <span class="keyword">new</span> File(simSunPath).toURI());</span><br><span class="line">        PhysicalFont simSunFont = PhysicalFonts.get(<span class="string">"SimSun"</span>);</span><br><span class="line"></span><br><span class="line">        Mapper fontMapper = IFontHandler.getFontMapper();</span><br><span class="line">        fontMapper.put(<span class="string">"SimSun"</span>, simSunFont);</span><br><span class="line"></span><br><span class="line">        wordMLPackage.setFontMapper(fontMapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSimSunPath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> simSunPath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSimSunPath</span><span class="params">(String simSunPath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.simSunPath = simSunPath;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-测试"><a href="#2-5-测试" class="headerlink" title="2.5 测试"></a>2.5 测试</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">docx4jDocxHtml</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    String html = <span class="string">"D:\\test\\docx4j\\Images-Sam.html"</span>;</span><br><span class="line">    String docx = <span class="string">"D:\\test\\docx4j\\_Images-Sam.docx"</span>;</span><br><span class="line">    Docx4jUtils.docx2html(docx, html, <span class="string">"D:\\test\\docx4j\\src"</span>, <span class="string">"D:\\test\\docx4j\\src"</span>, <span class="keyword">new</span> HtmlImageHandler());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">docx4jHtmlAltChunk2Docx</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    String html = <span class="string">"D:\\test\\docx4j\\Images-Sam.html"</span>;</span><br><span class="line">    String docx = <span class="string">"D:\\test\\docx4j\\Images-Sam.docx"</span>;</span><br><span class="line">    Docx4jUtils.htmlAsAltChunk2Docx(html, docx);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">docx4jDocx2Pdf</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    String docx = <span class="string">"D:\\test\\docx4j\\_Images-Sam.docx"</span>;</span><br><span class="line">    String pdf = <span class="string">"D:\\test\\docx4j\\_Images-Sam.pdf"</span>;</span><br><span class="line">    String ttc = <span class="string">"F:\\ttf\\simsun.ttc"</span>;</span><br><span class="line">    FontHandler fontHandler = <span class="keyword">new</span> FontHandler(ttc);</span><br><span class="line">    Docx4jUtils docx4jUtils = <span class="keyword">new</span> Docx4jUtils(fontHandler);</span><br><span class="line">    docx4jUtils.docx2Pdf(docx, pdf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">docx4jDocx2PdfNoFont</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    String docx = <span class="string">"D:\\test\\docx4j\\_Images-Sam.docx"</span>;</span><br><span class="line">    String pdf = <span class="string">"D:\\test\\docx4j\\_Images-Sam.pdf"</span>;</span><br><span class="line">    Docx4jUtils docx4jUtils = <span class="keyword">new</span> Docx4jUtils(<span class="keyword">new</span> IFontHandler() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFontMapper</span><span class="params">(WordprocessingMLPackage wordMLPackage)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        IFontHandler.<span class="keyword">super</span>.setFontMapper(wordMLPackage);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    docx4jUtils.docx2Pdf(docx, pdf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>源docx：</p>
<img src="https://raw.githubusercontent.com/innotsufox/static-src/main/img/202203202205488.png" style="zoom:90%;" />

<p>转html：</p>
<img src="https://raw.githubusercontent.com/innotsufox/static-src/main/img/202203202207720.png" style="zoom:80%;" />

<p>转回docx:</p>
<img src="https://raw.githubusercontent.com/innotsufox/static-src/main/img/202203202221656.png" style="zoom:90%;" />

<p>转PDF:</p>
<img src="https://raw.githubusercontent.com/innotsufox/static-src/main/img/202203202223554.png" style="zoom:90%;" />


<h2 id="3-参考"><a href="#3-参考" class="headerlink" title="3. 参考"></a>3. 参考</h2><blockquote>
<p><a href="https://github.com/plutext/docx4j-ImportXHTML" target="_blank" rel="noopener external nofollow noreferrer">https://github.com/plutext/docx4j-ImportXHTML</a></p>
<p><a href="https://github.com/plutext/docx4j-export-FO" target="_blank" rel="noopener external nofollow noreferrer">https://github.com/plutext/docx4j-export-FO</a></p>
</blockquote>
]]></content>
      <tags>
        <tag>Java</tag>
        <tag>Docx4j</tag>
        <tag>富文本</tag>
      </tags>
  </entry>
  <entry>
    <title>记乌俄战争</title>
    <url>/ji-wu-e-zhan-zheng.html</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="" />
    <label for="hbePass">请输入密码</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="fab67ced3ba83af21c8bc791916183e5ed7542ca8f0c58aad4bc5e5a719a9ee7">ef8ef678320fe69e5e433aa9e34f0829de39b5eda16e6f87429e7ee73c9c591c9382d3d7a501ed88c4d7900924d519b4729b04c2fe1f4646d5e8c5313ed08a9774035d35442f5c2e6bcd5ba16464ad3aa2336bef6e15ba4d665bf815af11debbe65840aa99b06910267bdea82b13b0f1addcedb3936a54f1d60cf281dfd4936c48bae19543ba2653d63095a1cd7766cc2d9d418734b1610c8006613b3f66e6b44459305e0fc6e08b763808958bd7e0616ae9733d38dd4ab48724285d1d814498fa8e3f289bdbcaa806eabe068d342a2101c2102e61413af9b447545505b943ad215741523b40bb77b6ba599660d9213db359397a71012efe30219ee14916bec5c1e8fd6ee49b8433bfd3f6b32a58a9de8d06e1f72f01f0d33c8001b5497e09f3b02c8923d29e5aa8371efac2c86a9b13506cadefb0151eefd09754581361b00672f5c0ac8f2154539bcd904f865a2d00a590edce5098fcb32cf5c7ccbf0e31b5dd38b77e8302f47746544fbf58bba228eaeb85cca0b60feb926e550f0d31591f89dc6b4de74189a938b18ee97aaf6e52d1381338c51d7906e85b5d51d9e5c5ecd86de1a24c9105769451a0286a56a2d72b8dab05cc5afaf8f56ffa287e284b59777dea52bddc15b471104276b47997e520b363d1dee3bb7ed322ca1dddd77bec607dd07b06f82e85983f996542d5c9423abfdd2a3c035f5930247650a160f22eba357c769cb34f848b8b9f10858f66367167cb909cee2b8b7664d8a761285eb93619ac1a241cf08b17cbfd39240fa031a2dacd5b538f7350fb0ace65a84569cb46f0a41840a72dc742a38af50c7036110eea85debafb633c9b6fc268ce3594aea06fc71c8bc16038973751d7f0499ac0a7def5a95b98f8bd42becac0b74e10f658ad7b1fc965a7cfc7618149c15d507beb9b65499d7988f24c8686bf65f536574e832575cfbc027422502293612c6f8ab958df1cd6131aabe51847c9e36f33183898e22d7c26c3dd91c49619eca6883b25ee6c1d9ea604315eaf1bbd218c30b6cf46e9af3783896f51731c6abf6c7d1badf18bcd07b4c0a935c3a376544e5dd48dd455227b0d76be532c7a0a05e02cf260d9e39076d53f2cc00aa459b1c1563524865740eb03161fd9b245ca09d94579413ee321653a2ffe8efd9c307f4ec2eb26b1d3b4637db8142e78ff89ff9dde60364f16e8a5badbc819eb152a11a36f94e8bc88c51d2d327a020b0c003baabbe3731d86bf38cf3e4e756b96baaac338855cbadb1137428fd63206df64cf3bd212363a54a2a9bbb8da3c37450e2bbdd5441d3d9338be7d237e641c0ce676e3959521b4892036e1ca5b57ab57cbe4dc32745304cb13d2154f35d11a35e9d310fe318dc71f15eca1b157dae74eaedb9e30ac82ffd0d7c446b50607ffe112579e4ccf41f85bf046974b6b889d29a4d2c357b45c49c38aa0ccc19aec0e5980cabd385b056e55749fbdf9f4c79c9c0345f1683f770b2e4ba25761bded1fc3df3da6a65cb5eb4e856a76492e383ed7df7bb2ee768f532315cb1334c871eac14c5c2faabb358adc586184b01fb0d18c01d407bb7e0b93fcadaf4b84d0ac8f20966b0028762a34303c8adfb813e355cf66aaef58ad8aca95fdef5838ecb96b9cefc0aa478c43b941644b249bda4493effbbe8186f60f87111c2c040ea27bda19da846fe14d87ba0da02c3668e16ba757398e0e10d90fbd9d7c76cb0b83eb41fca9e335b5478ca6a1e85fdad78b0e32854cdc5e2351e08a473eb7f718b9651b4b77287c8138f5ba40ca3a425da0a2de2f219ee6021fadb88bc51cf8bebb9781383d95da0bb47daa9f4d21d5bd0cbdc4eec9b7b5411e8fa105c0a19d514042f9ac3caeb5e9c291c13cf7c6d536cec27ab18e6da9ff3dfc1e10d13b612a5582eccf6108691484c9a1dec1f2b8d9b4d7d9a4f4df7d07310f20c393ee6d28f5f26a1f8c68104943c4848ec057cea7f36cdfe8af15f99a26cba85eef868c595740453b9b3d5234190a139f071c38a3a1ef7650ea2fcc2e68857e2c4f48018960dee28e6a130e551b787301bdaa187002eff6a9d5f49072727d2a360f59657ee191fc75d249a8d1b419b4016a23aa08cfd41560296cb14e99e558ca86d8dbf5397f163308ecdaa50c806be998b3eb569aaba0e48cd0883133b8d3538cf0441da1868e3ee6a1eb4db050fe84171ca3fc72a0f7a1b9d3b07647</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <tags>
        <tag>随笔</tag>
      </tags>
  </entry>
  <entry>
    <title>域名解析-免费SSL配置</title>
    <url>/yu-ming-jie-xi-mian-fei-ssl-pei-zhi.html</url>
    <content><![CDATA[<h1 id="Cloudflare-解析-Namecheap-上的域名以及安装免费的-Let’s-Encrypt-SSL"><a href="#Cloudflare-解析-Namecheap-上的域名以及安装免费的-Let’s-Encrypt-SSL" class="headerlink" title="Cloudflare 解析 Namecheap 上的域名以及安装免费的 Let’s Encrypt SSL"></a>Cloudflare 解析 Namecheap 上的域名以及安装免费的 Let’s Encrypt SSL</h1><h2 id="1-准备"><a href="#1-准备" class="headerlink" title="1. 准备"></a>1. 准备</h2><ul>
<li>Namecheap 上购买了域名；</li>
<li>服务器：ubuntu 20.04x64，已安装 Nginx、<code>certbot</code> <a href="https://certbot.eff.org/lets-encrypt/ubuntufocal-nginx" target="_blank" rel="noopener external nofollow noreferrer">certbot安装详细教程-官方</a></li>
<li>Cloudflare </li>
</ul>
<a id="more"></a>

<h2 id="2-Cloudflare-解析-Namecheap-上的域名-域名解析"><a href="#2-Cloudflare-解析-Namecheap-上的域名-域名解析" class="headerlink" title="2. Cloudflare 解析 Namecheap 上的域名 域名解析"></a>2. Cloudflare 解析 Namecheap 上的域名 域名解析</h2><h3 id="2-1-登录Cloudflare-添加站点"><a href="#2-1-登录Cloudflare-添加站点" class="headerlink" title="2.1 登录Cloudflare 添加站点"></a>2.1 登录Cloudflare <strong>添加站点</strong></h3><p><img src="https://raw.githubusercontent.com/innotsufox/static-src/main/img/202203012128222.png" alt=""></p>
<p>输入站点后，<strong>选择免费的</strong></p>
<p>Cloudflare将会自动扫描域名下已配置的DNS；</p>
<p>并提供名称服务器地址：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">leland.ns.cloudflare.com</span><br><span class="line">lola.ns.cloudflare.com</span><br></pre></td></tr></table></figure>

<h3 id="2-2-登录-Namecheap-修改域名名称服务器地址"><a href="#2-2-登录-Namecheap-修改域名名称服务器地址" class="headerlink" title="2.2 登录 Namecheap 修改域名名称服务器地址"></a>2.2 登录 Namecheap 修改域名<strong>名称服务器地址</strong></h3><p><img src="https://raw.githubusercontent.com/innotsufox/static-src/main/img/202203012129255.png" alt=""></p>
<h3 id="2-3-等待-Cloudflare-发邮件，表示已在Cloudflare激活域名"><a href="#2-3-等待-Cloudflare-发邮件，表示已在Cloudflare激活域名" class="headerlink" title="2.3 等待 Cloudflare 发邮件，表示已在Cloudflare激活域名"></a>2.3 等待 Cloudflare 发邮件，表示已在Cloudflare激活域名</h3><h3 id="2-4-Cloudflare-配置-DNS-记录"><a href="#2-4-Cloudflare-配置-DNS-记录" class="headerlink" title="2.4 Cloudflare 配置 DNS 记录"></a>2.4 Cloudflare 配置 DNS 记录</h3><p><img src="https://raw.githubusercontent.com/innotsufox/static-src/main/img/202203012130668.png" alt=""></p>
<p>其实就是解析后：域名、www.域名 都可访问</p>
<p><strong>注意：www的需要添加，否则SSL申请失败</strong></p>
<p>错误信息如下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Certbot failed to authenticate some domains (authenticator: nginx). The Certificate Authority reported these problems:</span><br><span class="line">  Domain: www.innofox.me</span><br><span class="line">  Type:   dns</span><br><span class="line">  Detail: DNS problem: NXDOMAIN looking up A <span class="keyword">for</span> www.innofox.me - check that a DNS record exists <span class="keyword">for</span> this domain</span><br><span class="line"></span><br><span class="line">Hint: The Certificate Authority failed to verify the temporary nginx configuration changes made by Certbot. Ensure the listed domains point to this nginx server and that it is accessible from the internet.</span><br></pre></td></tr></table></figure>

<h2 id="3-安装-Let’s-Encrypt-SSL"><a href="#3-安装-Let’s-Encrypt-SSL" class="headerlink" title="3. 安装 Let’s Encrypt SSL"></a>3. 安装 Let’s Encrypt SSL</h2><h3 id="3-1-SSH-远程-ubuntu-安装-SSL"><a href="#3-1-SSH-远程-ubuntu-安装-SSL" class="headerlink" title="3.1 SSH 远程 ubuntu 安装 SSL"></a>3.1 SSH 远程 ubuntu 安装 SSL</h3><p><strong>域名、邮箱换成你自己的</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">certbot --nginx --redirect -d www.example.com -d example.com -m admin@example.com --agree-tos --no-eff-email</span><br></pre></td></tr></table></figure>

<p>成功</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Successfully received certificate.</span><br><span class="line">Certificate is saved at: ***</span><br><span class="line">Key is saved at:         ***</span><br><span class="line">This certificate expires on 2022-01-29.</span><br><span class="line">These files will be updated when the certificate renews.</span><br><span class="line">Certbot has <span class="built_in">set</span> up a scheduled task to automatically renew this certificate <span class="keyword">in</span> the background.</span><br><span class="line"></span><br><span class="line">Deploying certificate</span><br><span class="line">Successfully deployed certificate <span class="keyword">for</span> www.innofox.me to ***</span><br><span class="line">Successfully deployed certificate <span class="keyword">for</span> innofox.me to ***</span><br><span class="line">Congratulations! You have successfully enabled HTTPS on https://www.innofox.me and https://innofox.me</span><br><span class="line"></span><br><span class="line">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class="line">If you like Certbot, please consider supporting our work by:</span><br><span class="line"> * Donating to ISRG / Let<span class="string">'s Encrypt:   https://letsencrypt.org/donate</span></span><br><span class="line"><span class="string"> * Donating to EFF:                    https://eff.org/donate-le</span></span><br><span class="line"><span class="string">- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></span><br></pre></td></tr></table></figure>







]]></content>
      <tags>
        <tag>cloudflare</tag>
        <tag>域名解析</tag>
        <tag>SSL</tag>
      </tags>
  </entry>
  <entry>
    <title>1984</title>
    <url>/1984.html</url>
    <content><![CDATA[<blockquote>
<p>读后感</p>
<p>书屋</p>
</blockquote>
<p>离读完1984已有月余，感概此时书中角色名称我已忘记。脑海中却隐约浮现那几个字句：<strong>老大哥</strong>、<strong>电幕</strong>、<strong>双重思想</strong>、<strong>101号房</strong>、<strong>谁控制了过去，谁就控制了未来，谁控制了现在，谁就控制了过去</strong>…</p>
<a id="more"></a>

<h3 id="末世的预言之书"><a href="#末世的预言之书" class="headerlink" title="末世的预言之书"></a>末世的预言之书</h3><p>此书成于40年代奥威尔之手，感慨作者作为一个<strong>民主社会主义</strong>的拥护者，独裁者斯大林自然容不下他的，惨遭迫害，或许这样，才成就了他写出《<em>1984<em>》 、《</em>动物庄园</em> 》这些奇书吧。</p>
<p><a href="https://zh.wikipedia.org/wiki/%E4%B9%94%E6%B2%BB%C2%B7%E5%A5%A5%E5%A8%81%E5%B0%94" target="_blank" rel="noopener external nofollow noreferrer">奥威尔</a></p>
<blockquote>
<p>奥威尔描绘了一个极权主义达到顶峰的可怕的社会，在这个社会中思想自由是一种死罪，独立自主的个人被消灭干净，每一个人的思想都受到严密的控制，掌握权力的人们以追逐权力为终极目标并对权力顶礼膜拜。(wiki)</p>
</blockquote>
<blockquote>
<p>我并不相信我在书中所描述的社会必定会到来，但是，我相信某些与其相似的事情可能会发生。还相信，极权主义思想已经在每一个地方的知识分子心中扎下了根，我试图从这些极权主义思想出发，通过逻辑推理，引出其发展下去的必然结果。(奥威尔)</p>
</blockquote>
<h3 id="记"><a href="#记" class="headerlink" title="记"></a>记</h3><p>作为<strong><em>反乌托邦</em></strong> 题材的著作，其中描绘出一幅独裁到极致的社会画卷。公民受到<strong>电幕</strong>监控、每天都在因<strong><em>形势</em></strong> 修改历史、人们思想受控制<strong>洗脑</strong>、精神领袖<strong>老大哥</strong>等等。</p>
<p>老大哥每天都看着你，人们不知道老大哥什么时候存在，也不知道祂何时死去，甚至认为祂从人类诞生之时就已经存在了。</p>
<p>主人翁在报社工作，每天按要求使用<strong>新语</strong>修改着以前的报纸。新语删除对“社会不利的词”，使人们忘记它。</p>
<blockquote>
<p>历史可以被修改，因为几十年后，没人见证过历史，他仅仅被记录，被人记录，自然能被人修改的。</p>
</blockquote>
<p>文中经常会出现的“我们到底在跟谁打仗？”</p>
<blockquote>
<p>我们在同欧亚国打仗？不，如果情势有变，我们可以和欧亚国从未打过仗，我们仅仅和东亚国打仗而与欧亚国结盟。</p>
</blockquote>
<p>人们如何相信被修改的历史呢？</p>
<blockquote>
<p>双重思想</p>
</blockquote>
<p>或许<em>新思想覆写旧思想</em> 就是<strong>双重思想</strong>吧</p>
<p>如何消减人们反抗的欲望？</p>
<p>如何麻木身边的痛苦？</p>
<p>在高度压力下，饥寒交迫时，精神领袖的伟大崇拜，再塑造远在天边的敌国。总会有方法来转移注意力的。💥</p>
<p>即使在如此高压下，总有人去追求原始的欲望–爱情，总有人想要挣脱牢笼，去反抗、去寻找、去追逐😡。</p>
<h3 id="思"><a href="#思" class="headerlink" title="思"></a>思</h3><blockquote>
<p>老大哥</p>
</blockquote>
<p>精神领袖，无处不在</p>
<blockquote>
<p>电幕</p>
</blockquote>
<p>作为监控人们的设备，观察人们是否有异常，来怕排除思想出问题的人。</p>
<blockquote>
<p>双重思想</p>
</blockquote>
<p>用于洗脑的“思想”，以此相信被修改的历史。</p>
<blockquote>
<p>101号房</p>
</blockquote>
<p>犯下思想罪的人，不会被马上处死，而是需要被“清洗成思想纯洁的，对老大哥忠诚的人”，然后才能被处死。101号房，用于“罪犯”被“清洗”后的刑房。</p>
<blockquote>
<p>谁控制了过去，谁就控制了未来，谁控制了现在，谁就控制了过去</p>
</blockquote>
<p>然后推出谁控制现在，谁就控制了过去和未来</p>
<h3 id="末"><a href="#末" class="headerlink" title="末"></a>末</h3><p>主人翁最后在监狱里被折磨成“纯洁”的人，磨灭了他全部的自我的思想。</p>
<p>我想，这就是反乌托邦吧。</p>
<p>欧洲人可能会觉得这描写的是纳粹，国人会认为是文革……每个国家有他的记忆与痛。</p>
<p>可是，人们会从历史中学到什么呢？前车之鉴？还是重蹈覆辙？</p>
<p>我不知道，只知道人类需要保持警惕吧。</p>
<blockquote>
<p>上一个1984已经过去，下一个还会远吗？</p>
</blockquote>
]]></content>
      <tags>
        <tag>随笔</tag>
      </tags>
  </entry>
</search>
